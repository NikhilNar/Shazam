AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Resources:
  LFMovieList:
    Type: AWS::Serverless::Function
    Properties:
      Runtime: nodejs10.x
      CodeUri: s3://shazam-sam-templates/31548103f16d187c24ffdefef5b2c36e
      Handler: movies_list.handler
      Events:
        HttpPost:
          Type: Api
          Properties:
            Path: /movies-list
            Method: get
      Policies:
      - CloudWatchLogsFullAccess
  LFMovieViews:
    Type: AWS::Serverless::Function
    Properties:
      Runtime: nodejs10.x
      CodeUri: s3://shazam-sam-templates/31548103f16d187c24ffdefef5b2c36e
      Handler: movies_views.handler
      Events:
        HttpPost:
          Type: Api
          Properties:
            Path: /movies-watched
            Method: post
      Policies:
      - CloudWatchLogsFullAccess
      - AmazonSQSFullAccess
  LFViewAndRatingUpdater:
    Type: AWS::Serverless::Function
    Properties:
      Runtime: python3.6
      CodeUri: s3://shazam-sam-templates/31548103f16d187c24ffdefef5b2c36e
      Handler: view_rating_updater.handler
      Events:
        CloudwatchCronEvent:
          Type: Schedule
          Properties:
            Schedule: rate(1 minute)
      Policies:
      - CloudWatchLogsFullAccess
      - AmazonSQSFullAccess
  LFEMRJob:
    Type: AWS::Serverless::Function
    Properties:
      Runtime: python3.6
      CodeUri: s3://shazam-sam-templates/31548103f16d187c24ffdefef5b2c36e
      Handler: spark_invoker.lambda_handler
      Events:
        CloudwatchCronEvent:
          Type: Schedule
          Properties:
            Schedule: rate(1 minute)
      Policies:
      - CloudWatchLogsFullAccess
      - AmazonSQSFullAccess
      - AmazonElasticMapReduceFullAccess
  SQSViewsQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: SQSViewsQueue
Globals:
  Api:
    Cors:
      AllowMethods: '''*'''
      AllowHeaders: '''*'''
      AllowOrigin: '''*'''
